"use strict";var _createClass=function(){function r(e,n){for(var t=0;t<n.length;t++){var r=n[t];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(e,n,t){return n&&r(e.prototype,n),t&&r(e,t),e}}();function _classCallCheck(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}var DBHelper=function(){function o(){_classCallCheck(this,o)}return _createClass(o,null,[{key:"fetchRestaurants",value:function(t){var r=new XMLHttpRequest;r.open("GET",o.DATABASE_URL_restaurants),r.onreadystatechange=function(){4==this.readyState&&(r.onload=function(){if(200===r.status){var e=JSON.parse(r.responseText);for(var n in idbKeyval.clear(),e)idbKeyval.set(e[n].id,e[n]);t(null,e)}else{r.status;dbPromise.then(function(e){return e.transaction("keyval").objectStore("keyval").getAll()}).then(function(e){return t(null,e)})}},""==r.response&&dbPromise.then(function(e){return e.transaction("keyval").objectStore("keyval").getAll()}).then(function(e){return t(null,e)}))},r.send()}},{key:"fetchReviews",value:function(e,n){var t=new XMLHttpRequest;t.open("GET","http://localhost:1337/reviews/?restaurant_id="+e),t.onreadystatechange=function(){4==this.readyState&&(t.onload=function(){if(200===t.status){var e=JSON.parse(t.responseText);n(null,e)}})},t.send()}},{key:"checkConnection",value:function(){var e=new XMLHttpRequest;e.open("GET","http://localhost:1337/reviews"),e.onreadystatechange=function(){4==this.readyState&&(e.onload=function(){200===e.status&&dbReviews.then(function(e){return e.transaction("reviewsdb").objectStore("reviewsdb").getAll()}).then(function(e){for(var n in e)$.ajax({url:"http://localhost:1337/reviews",type:"post",data:e[n]});idbReviews.clear()})})},e.send()}},{key:"fetchRestaurantById",value:function(r,a){o.fetchRestaurants(function(e,n){if(e)a(e,null);else{var t=n.find(function(e){return e.id==r});t?a(null,t):a("Restaurant does not exist",null)}})}},{key:"fetchRestaurantByCuisine",value:function(r,a){o.fetchRestaurants(function(e,n){if(e)a(e,null);else{var t=n.filter(function(e){return e.cuisine_type==r});a(null,t)}})}},{key:"fetchRestaurantByNeighborhood",value:function(r,a){o.fetchRestaurants(function(e,n){if(e)a(e,null);else{var t=n.filter(function(e){return e.neighborhood==r});a(null,t)}})}},{key:"fetchRestaurantByCuisineAndNeighborhood",value:function(r,a,u){o.fetchRestaurants(function(e,n){if(e)u(e,null);else{var t=n;"all"!=r&&(t=t.filter(function(e){return e.cuisine_type==r})),"all"!=a&&(t=t.filter(function(e){return e.neighborhood==a})),u(null,t)}})}},{key:"fetchNeighborhoods",value:function(a){o.fetchRestaurants(function(e,t){if(e)a(e,null);else{var r=t.map(function(e,n){return t[n].neighborhood}),n=r.filter(function(e,n){return r.indexOf(e)==n});a(null,n)}})}},{key:"fetchCuisines",value:function(a){o.fetchRestaurants(function(e,t){if(e)a(e,null);else{var r=t.map(function(e,n){return t[n].cuisine_type}),n=r.filter(function(e,n){return r.indexOf(e)==n});a(null,n)}})}},{key:"urlForRestaurant",value:function(e){return"./restaurant.html?id="+e.id}},{key:"imageUrlForRestaurant",value:function(e){return"/img/"+e.photograph+".webp"}},{key:"smallImageUrlForRestaurant",value:function(e){return"/img/small/"+e.photograph+".webp"}},{key:"mapMarkerForRestaurant",value:function(e,n){return new google.maps.Marker({position:e.latlng,title:e.name,url:o.urlForRestaurant(e),map:n,animation:google.maps.Animation.DROP})}},{key:"DATABASE_URL_restaurants",get:function(){return"http://localhost:1337/restaurants"}}]),o}();window.addEventListener("online",function(e){console.log("online"),DBHelper.checkConnection()});