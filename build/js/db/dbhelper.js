"use strict";var _createClass=function(){function a(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(e,t,n){return t&&a(e.prototype,t),n&&a(e,n),e}}();function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var DBHelper=function(){function o(){_classCallCheck(this,o)}return _createClass(o,null,[{key:"fetchRestaurants",value:function(n){var a=new XMLHttpRequest;a.open("GET",o.DATABASE_URL_restaurants),a.onreadystatechange=function(){4==this.readyState&&(a.onload=function(){if(200===a.status){var e=JSON.parse(a.responseText);for(var t in idbKeyval.clear(),e)idbKeyval.set(e[t].id,e[t]);n(null,e)}else{a.status;dbPromise.then(function(e){return e.transaction("keyval").objectStore("keyval").getAll()}).then(function(e){return n(null,e)})}},""==a.response&&dbPromise.then(function(e){return e.transaction("keyval").objectStore("keyval").getAll()}).then(function(e){return n(null,e)}))},a.send()}},{key:"fetchReviews",value:function(e,t){var n=new XMLHttpRequest;n.open("GET","http://localhost:1337/reviews/?restaurant_id="+e),n.onreadystatechange=function(){4==this.readyState&&(n.onload=function(){if(200===n.status){var e=JSON.parse(n.responseText);t(null,e)}})},n.send()}},{key:"checkConnection",value:function(){var e=new XMLHttpRequest;e.open("GET","http://localhost:1337/reviews"),e.onreadystatechange=function(){4==this.readyState&&(e.onload=function(){200===e.status&&dbReviews.then(function(e){return e.transaction("reviewsdb").objectStore("reviewsdb").getAll()}).then(function(e){for(var t in e)$.ajax({url:"http://localhost:1337/reviews",type:"post",data:e[t]});idbReviews.clear()})})},e.send()}},{key:"fetchRestaurantById",value:function(a,r){o.fetchRestaurants(function(e,t){if(e)r(e,null);else{var n=t.find(function(e){return e.id==a});n?r(null,n):r("Restaurant does not exist",null)}})}},{key:"fetchRestaurantByCuisine",value:function(a,r){o.fetchRestaurants(function(e,t){if(e)r(e,null);else{var n=t.filter(function(e){return e.cuisine_type==a});r(null,n)}})}},{key:"fetchRestaurantByNeighborhood",value:function(a,r){o.fetchRestaurants(function(e,t){if(e)r(e,null);else{var n=t.filter(function(e){return e.neighborhood==a});r(null,n)}})}},{key:"fetchRestaurantByCuisineAndNeighborhood",value:function(a,r,u){o.fetchRestaurants(function(e,t){if(e)u(e,null);else{var n=t;"all"!=a&&(n=n.filter(function(e){return e.cuisine_type==a})),"all"!=r&&(n=n.filter(function(e){return e.neighborhood==r})),u(null,n)}})}},{key:"fetchNeighborhoods",value:function(r){o.fetchRestaurants(function(e,n){if(e)r(e,null);else{var a=n.map(function(e,t){return n[t].neighborhood}),t=a.filter(function(e,t){return a.indexOf(e)==t});r(null,t)}})}},{key:"fetchCuisines",value:function(r){o.fetchRestaurants(function(e,n){if(e)r(e,null);else{var a=n.map(function(e,t){return n[t].cuisine_type}),t=a.filter(function(e,t){return a.indexOf(e)==t});r(null,t)}})}},{key:"urlForRestaurant",value:function(e){return"./restaurant.html?id="+e.id}},{key:"imageUrlForRestaurant",value:function(e){return"/img/"+e.photograph+".webp"}},{key:"smallImageUrlForRestaurant",value:function(e){return"/img/small/"+e.photograph+".webp"}},{key:"mapMarkerForRestaurant",value:function(e,t){return new google.maps.Marker({position:e.latlng,title:e.name,url:o.urlForRestaurant(e),map:t,animation:google.maps.Animation.DROP})}},{key:"DATABASE_URL_restaurants",get:function(){return"http://localhost:1337/restaurants"}}]),o}();